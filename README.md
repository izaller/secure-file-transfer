# secure-file-transfer
project completed in fulfillment of requirements for Aquincum Institute of Technology's Applied Cryptography course.

## required package installation
Before use, run the following commands from the terminal
```
pip install pyDH
pip install pycryptodome
```

## running the program

use the following commands in separate terminal windows:
```
python3 network.py -p './network/' -a 'USM' --clean
python3 server.py
python3 client.py
```

## network.py
Sets up the network in a folder called "network". Running the network.py command
highlighted in the box above will create folders based on the -a
parameters. The folders correspond to addresses of users on the network.
'U' and 'S' stand for 'user' and 'server'. 'M' stands for 'Mallory'. 
## server.py
Extremely basic right now.

Requires that first char of message received be the sender's
address so that server can send response to sender. The server only 
accepts one user logged on at a time. Commands or login requests from
users other than the currently logged on user will not be accepted.

## data structures
### session
Stores two values: partner address and AES key

### serverif
Server interface. Stores its own address ('S'), the network path ('./network') and a session (defaults to None).
When a user successfully logs in, a session is created and stored. Session stores partner's address (user address)
and shared AES key.

### user
Client-side object. Created at login. Stores user's own address and a session.
Session contains partner's address (server) and shared AES key.


## client.py
Collects user input message and sends to server using netinterface.

Concatenates user's own address to message before sending so that server.py
can send a response message.

## login
Unprotected implementation supported.

Login uses Diffie-Hellman exchange to generate a shared secret and HKDF (with salt generated by the user)
to generate an AES key which can be used as the session key.

Current message exchange:

> user to server: **[address | login request | password | g^x mod p | sig(...)]**

Login request signified by keycode '1' (see commands dictionary in client_ops.py). Password is hard-coded as *password* for all users. If user submits valid password, server returns response '1'. Otherwise the 
server returns '0'.

> server to user: **[correct password | g^y mod p | sigS(addr | g^x mod p | S | g^y mod p)]**

*Note: if password is incorrect, only **[incorrect password]** flag is sent* ('0') *and login process terminates*

> user to server: **[U | salt | sigU(addr | g^x mod p | S | g^y mod p)]**

After all of these messages check out, users compute the shared AES key using HKDF. Once a user has successfully logged in, they are given a list of commands they can use.



### login demo
In two separate terminal tabs, execute the following commands
to start the network and the server.
```
python3 network.py -p './network/' -a 'USM' --clean
python3 server.py
```
Open another tab and run ```python3 client.py```.
When prompted, enter 'U' for user address and 'password' for the password.
You should now be logged in.

Finally, open a fourth tab and once again run ```python3 client.py```.
When prompted, enter 'M' for user address and any password.
You should receive the following message: *The server is currently unavailable. Please try again later.*
